!function(){function e(){}function i(e){e&&this.setOptions(e)}i.prototype={setOptions:function(i){return this.dom=i.listDom||"",this.pagesize=i.pageSize,this.dataloader=i.dataLoader||e,this.htmlrender=i.htmlRender||e,this.threshold=i.threshold||300,this._recycle=!!i.recycle,this.loadDone=i.loadDone||e,this._nomore=i.customNomore||function(){return"<div></div>"},this.nomore=void 0,this.listLoading=i.listLoading||function(){return"<div>loading...</div>"},this.dom?void 0===this.pagesize?void console.warn("PageSize can not be null"):(this._listContainer=$("<ul/>",{"class":"infinitelist-container"}),this._loading=$(this.listLoading()),this._userdom=$(this.dom).append(this._listContainer).append(this._loading),this._pageListData={},this._pageindex=0,this._renderingsign=!1,this._nomoretag=!1,void this._initList()):void console.warn("ListDom can not be null")},_showNomore:function(){this.nomore=$(this._nomore()).show(),this._userdom.append(this.nomore)},_initList:function(){function e(){var e=window.innerHeight+window.scrollY;e>=i._listContainer.height()-i.threshold&&!i._renderingsign&&!i._nomoretag&&i._loadPage(),i._updatePage()}var i=this;$(window).on("scroll",e),i._loadPage()},_loadPage:function(){var e=this;e._renderingsign=!0,e._pageindex++,e._loading.hide(),e._getPageDom(e._pageindex,function(i){e._listContainer.append($("<div/>",{"class":"infinitelist-page infinitelist-pageindex"+e._pageindex,"data-page":e._pageindex}).append(i)),e._renderingsign=!1,e._loading.hide(),e.loadDone()})},_getPageItemOffset:function(e){var i=document.body.scrollTop;return 0===i?0:Math.floor((i-this._listContainer.offset().top+window.innerHeight/2)/e)},_updatePage:function(){var e=this._listContainer.find(".infinitelist-page"),i=this._getPageItemOffset(e.first().height()),t=e.first().data("page"),n=i+t;this._recyclePage(e.slice(0,n>2?n-2:0),e.slice(n>2?n+2:0,n>2?this._pageindex:0)),this._resumePage(e.slice(n>2?n-2:0,n+2))},_getPageDom:function(e,i){var t=this;t._getData(e,function(e){i(t.htmlrender(e))})},_getData:function(e,i){var t=this;t._pageListData[e]?i(t._pageListData[e]):(t._loading.show(),t.dataloader(e,function(n){1===t._pageindex&&0==n.length&&(t._loading.hide(),t._showNomore(),t._nomoretag=!0),n.length<t.pagesize&&(t._nomoretag=!0),t._pageListData[e]=n,i(n)},function(){i([])}))},_resumePage:function(e){var i=this;e.each(function(){var e=$(this);e.hasClass("recycle")&&i._getPageDom(e.data("page"),function(t){e.append(t),e.css("height","auto"),e.removeClass("recycle"),i.loadDone()})})},_recyclePage:function(e,i){var t=this;e.each(function(){var e=$(this);e.hasClass("recycle")||(e.addClass("recycle"),e.css("height",e.height()+"px"),e.html(""))}),i.each(function(){var e=$(this),i=e.data("page");t._pageindex>=~~e.data("page")&&(t._pageindex=~~e.data("page")-1),t._recycle&&delete t._pageListData[i]}),i.remove()},reloadData:function(e){var i=this,t=i._listContainer.find(e),n=t.length?t.parents(".infinitelist-page").data("page"):0;n>0&&(delete i._pageListData[n],i._getPageDom(n,function(e){$(".infinitelist-pageindex"+n).html(e),i._loading.hide()}))},clear:function(){this._listContainer.empty(),this._pageindex=0,this._pageListData={},this._nomoretag=!1,this.nomore&&this.nomore.remove(),this._loadPage()}},window.InfiniteList=i}();